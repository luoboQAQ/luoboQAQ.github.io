<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="配置Linux环境下的字体，解决字体样式错误、异形字、全角引号以及合成字体"><title>fontconfig：Linux下的字体配置</title><link rel=canonical href=https://lbqaq.top/p/linux-font/><link rel=stylesheet href=/scss/style.min.2d47bd8ef39ed3b6e381fc30c41c603c9773b1b9e311595afb8f0ffebf5b9437.css><meta property='og:title' content="fontconfig：Linux下的字体配置"><meta property='og:description' content="配置Linux环境下的字体，解决字体样式错误、异形字、全角引号以及合成字体"><meta property='og:url' content='https://lbqaq.top/p/linux-font/'><meta property='og:site_name' content='luoboQAQ'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Linux'><meta property='article:tag' content='字体'><meta property='article:tag' content='教程'><meta property='article:published_time' content='2023-07-05T20:58:15+08:00'><meta property='article:modified_time' content='2023-07-05T20:58:15+08:00'><meta property='og:image' content='https://lbqaq.top/p/linux-font/109572761.webp'><meta name=twitter:title content="fontconfig：Linux下的字体配置"><meta name=twitter:description content="配置Linux环境下的字体，解决字体样式错误、异形字、全角引号以及合成字体"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://lbqaq.top/p/linux-font/109572761.webp'><script async defer data-website-id=5a23d952-27c7-4abd-b8f0-c69397b25b55 data-cache=true src=https://umami.lbqaq.top/bpnwxrgz.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><style>:root{--sys-font-family:-apple-system, "LXGW WenKai", 'Microsoft Yahei', 'WenQuanYi Micro Hei', sans-serif;--code-font-family:"JetBrains Mono", "LXGW WenKai Mono", Menlo, Monaco, Consolas, monospace;--article-font-family:"LXGW WenKai", sans-serif;--base-font-family:"LXGW WenKai", var(--sys-font-family), sans-serif}</style></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/Mint_hu_90cbcbb19cfdb02a.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🌞</span></figure><div class=site-meta><h1 class=site-name><a href=/>luoboQAQ</a></h1><h2 class=site-description>快乐学习每一天</h2></div></header><ol class=menu-social><li><a href=https://github.com/luoboQAQ target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://lbqaq.top/index.xml target=_blank title=RSS订阅 rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://pan.lbqaq.top target=_blank title=我的个人云盘 rel=me><svg class="icon icon-tabler icon-tabler-cloud" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 18a4.6 4.4.0 010-9 5 4.5.0 0111 2h1a3.5 3.5.0 010 7H7"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>文章</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>查询</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友链</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#字体的分类>字体的分类</a></li><li><a href=#选字体>选字体</a></li><li><a href=#fontconfig>fontconfig</a><ol><li><a href=#字体的属性>字体的属性</a></li><li><a href=#通用字族名>通用字族名</a></li><li><a href=#如何调试>如何调试</a></li><li><a href=#配置文件>配置文件</a></li></ol></li><li><a href=#开始配置>开始配置</a><ol><li><a href=#设置默认字体>设置默认字体</a></li><li><a href=#设置异形字>设置异形字</a></li><li><a href=#解决全角引号>解决全角引号</a></li><li><a href=#覆盖西文字体>覆盖西文字体</a></li><li><a href=#替换任意字体>替换任意字体</a></li><li><a href=#字体渲染参数>字体渲染参数</a></li></ol></li><li><a href=#遇到的问题>遇到的问题</a><ol><li><a href=#全角引号设置无效>全角引号设置无效</a></li></ol></li><li><a href=#不能解决的问题>不能解决的问题</a></li><li><a href=#参考文献>参考文献</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/linux-font/><img src=/p/linux-font/109572761.webp width=1200 height=825 loading=lazy alt="Featured image of post fontconfig：Linux下的字体配置"></a></div><div class=article-details><header class=article-category><a href=/categories/linux/>Linux</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/linux-font/>fontconfig：Linux下的字体配置</a></h2><h3 class=article-subtitle>配置Linux环境下的字体，解决字体样式错误、异形字、全角引号以及合成字体</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2023-07-05</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 11 分钟</time></div></footer></div></header><section class=article-content><h2 id=字体的分类><a href=#%e5%ad%97%e4%bd%93%e7%9a%84%e5%88%86%e7%b1%bb class=header-anchor></a>字体的分类</h2><p>字体的数量可以说是成千上万，但一般在电脑上显示的基本为以下这三类<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>：</p><ul><li><p>monospace [等宽]</p><p>等宽字体是指字符宽度相同的字体，用于需要字符严格对齐的场合，例如控制台和源代码。与此相对，字符宽度各不相同的字体称为比例字体(其余四类字体都是)。不过，对于中文字体而言，并不存在等宽与比例的差别，因为所有中文字都是等宽的。中文字体中的“等宽”指的是字体的西文部分是等宽的，2个字母对应1个汉字。</p></li><li><p>sans-serif [无衬线]</p><p>是指笔画末端没有修饰(衬线)的字体，通常用于屏幕显示。中文的黑体与圆体就属于此类字体。</p></li><li><p>serif [有衬线]</p><p>是指笔画末端有修饰(衬线)的字体，通常用于打印。中文的宋体与仿宋就属于此类字体。</p></li></ul><p>我们要做的字体配置主要就是针对上面这三类字体。</p><h2 id=选字体><a href=#%e9%80%89%e5%ad%97%e4%bd%93 class=header-anchor></a>选字体</h2><p>有了目标，下面就是选一个自己喜欢的字体了。不过，对于中文字体，目前现在 Linux 上常用的、在维护的开源中文字体就一套——“思源黑体”和“思源宋体”，同时被 <a class=link href=https://en.wikipedia.org/wiki/Noto_fonts target=_blank rel=noopener>Noto</a> 和<a class=link href=https://en.wikipedia.org/wiki/Source_Han_Sans target=_blank rel=noopener>思源</a>两个项目收录。Noto 系列字体是 Google 主导的，思源系列字体是 Adobe 主导的。<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><p>对于编程字体，可以选择的余地就多多了，像是Source Code Pro，Consolas，Menlo等等。我一开始选择的是 <a class=link href=https://github.com/be5invis/Iosevka target=_blank rel=noopener>Iosevka</a> 。但是，这款字体给我感觉太瘦了，看起来很是别扭。最后，我选择了广受好评的 <a class=link href=https://github.com/tonsky/FiraCode target=_blank rel=noopener>Fira Code</a> 。</p><p>小结一下，我的选择是：</p><ul><li>无衬线：西文 Noto Sans，中文 Noto Sans CJK</li><li>衬线：西文 Noto Serif，中文 Noto Serif CJK</li><li>等宽：西文 Fira Code，中文 Noto Sans Mono CJK</li></ul><p>在ArchLiunx上，我们只需要安装<code>noto-fonts</code>和<code>noto-fonts-cjk</code>这两个包即可，他们分别提供了西文字体 Noto Sans / Noto Serif和中文字体 Noto Sans CJK / Noto Serif CJK / Noto Sans Mono CJK 。<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><p>关于 emoji，我选择了 Twitter 推出的字体 Twemoji。</p><ul><li>ttf-twemoji</li></ul><p>另外，少不了人见人爱的图标字体 Nerd Fonts。</p><ul><li>ttf-nerd-fonts-symbols</li></ul><p>这里就有小伙伴开始好奇了，如何让西文和中文使用不同的字体呢？</p><p>在 Windows 下，我们可以选择合成字体，即将各类字体打包到一起。例如<a class=link href=https://github.com/be5invis/Sarasa-Gothic target=_blank rel=noopener>更纱黑体</a>就是由思源黑体和西文字体 Iosevka 整合而来的。这种字体的好处就是方便，直接选择使用即可。但是缺点也是显而易见，就是打包太麻烦了，引入 Iosevka 要打一次包，想要支持 Nerd Fonts，又要打一次包。如果是别人帮你提供好的合成字体那还好说， 从网上下载、从软件仓库安装就完事了，自己打包的话真的工作量巨大。</p><p>而在 Liunx 下，我们只需要配置 fontconfig 就好了，无论想怎么搭配都可以实现，听起来是不是特别酷😎。可惜的是，有一些程序对 fontconfig 支持并不完善，这就达不到我们想要的效果。（说的就是你，Chrome😠）</p><h2 id=fontconfig><a href=#fontconfig class=header-anchor></a>fontconfig</h2><p>在我们开始正式配置前，还是有必要了解一些基本的知识。这里我就简单介绍一下，如果想要深入了解的话可以看看双猫大佬的<a class=link href=https://catcat.cc/post/2020-10-31/ target=_blank rel=noopener>这篇文章</a>，里面详细介绍了Linux fontconfig 的字体匹配机制。</p><h3 id=字体的属性><a href=#%e5%ad%97%e4%bd%93%e7%9a%84%e5%b1%9e%e6%80%a7 class=header-anchor></a>字体的属性</h3><p>字体有很多属性，常用的有字族（family）、倾斜（slant）、字重（weight）。后两者合一起叫样式（style）。</p><p>字族就是它的名字啦。一个字体文件，可以提供多个字体族名 (family)。比如 Arch Linux 用户在安装 wqy-microhei 后，系统端增加了 wqy-microhei.ttc 这个字体文件，分别提供「WenQuanYi Micro Hei」「文泉驛微米黑」,「文泉驿微米黑」三个字体族名，它们是一个意思。我们可以运行 fontconfig 提供的命令行工具 fc-list 去查看系统上已安装的字体已经它们对应的字体族名。</p><p>倾斜就是斜不斜，英文叫「Roman」「Italic」或者「Oblique」，Italic 是专门的斜体写法（更接近手写样式）， Oblique 是把常规写法倾斜一下完事。</p><p>字重就更简单了，就是笔划的粗细。常见的有 Regular、Normal、Medium、Bold、Semibold、Black、Thin、Light、Extralight 等。</p><h3 id=通用字族名><a href=#%e9%80%9a%e7%94%a8%e5%ad%97%e6%97%8f%e5%90%8d class=header-anchor></a>通用字族名</h3><p>很多时候，程序并不在乎用户具体使用的是哪款字体，像很多网站的 CSS 那样把各个平台的常见字体全部列出来太傻了，又容易出问题。所以，人们发明了「通用字族名」，也就是 sans-serif (sans)、serif 和 monospace (mono) 这些。它们不是真实存在的字体，而是分别指示程序去使用无衬线、衬线、等宽字体。那么桌面程序又是如何知道具体使用哪些字体呢？它只需要去查询 fontconfig 就行了。由于它们必定要经过 fontconfig 的查询流程后才能使用字体，所以我们可以通过 fontconfig 的配置去精准控制程序使用的字体。</p><h3 id=如何调试><a href=#%e5%a6%82%e4%bd%95%e8%b0%83%e8%af%95 class=header-anchor></a>如何调试</h3><p>传入环境变量<code>FC_DEBUG=4</code>即可，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>FC_DEBUG</span><span class=o>=</span><span class=m>4</span> kitty
</span></span></code></pre></td></tr></table></div></div><p>fontconfig 就会打印调试信息，其中可以看到：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>FcConfigSubstitute Pattern has 6 elts (size 16)
</span></span><span class=line><span class=cl>    family: &#34;monospace&#34;(s)
</span></span><span class=line><span class=cl>    slant: 0(i)(s)
</span></span><span class=line><span class=cl>    weight: 80(i)(s)
</span></span><span class=line><span class=cl>    pixelsize: 19.1667(f)(s)
</span></span><span class=line><span class=cl>    lang: &#34;en&#34;(w)
</span></span><span class=line><span class=cl>    prgname: &#34;kitty&#34;(s)
</span></span></code></pre></td></tr></table></div></div><p>除了启动一个程序来看它字体的调用日志，我们也可以手动调用。例如，我想看 monospace 在系统里被修改成了什么字体，就可以执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>FC_DEBUG</span><span class=o>=</span><span class=m>4</span> fc-match <span class=s1>&#39;monospace&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>打印出的调试信息会很长，我们主要看几个部分：</p><p>第一部分，Add Rule，指已添加的配置文件规则。这里面也包含了家目录下的配置文件，可以找来看看被解析成了什么。</p><p>第二部分，在 Add Rule 之后，迎来了最关键的、我们应当关心的 FcConfigSubstitute Pattern，它包含了 font pattern。(s) 和 (w) 分别代表强弱绑定；prgname 代表程序名，此时就是 fc-match。至于 lang，由于没有对 fc-match 指定语言，所以默认是 en。</p><p>接下来有很多条 FcConfigSubstitute editPattern，代表对 font pattern 的替换操作。但是必须当规则匹配的时候，也就是 Rule Set 不是 No match 的情况下，才执行 FcConfigSubstitute editPattern。那么，又应该怎么看 FcConfigSubstitute editPattern 呢？主要看 family，因为 family 代表着字体匹配顺序。它就是配置文件中的<code>&lt;edit target="pattern"></code>操作。</p><p>最后应该关心 FcConfigSubstitute donePattern，这是 fontconfig 执行完字体替换后的结果。</p><h3 id=配置文件><a href=#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 class=header-anchor></a>配置文件</h3><p>整个配置文件由如下几个部分依次拼接而成：</p><ol><li>目录设置(<code>&lt;dir></code>, <code>&lt;cachedir></code>, <code>&lt;include></code>)</li><li>杂项设置(<code>&lt;config></code>)</li><li>扫描阶段(<code>&lt;match target="scan"></code>)</li><li>匹配阶段(<code>&lt;alias></code>, <code>&lt;match target="pattern"></code>)</li><li>渲染阶段(<code>&lt;match target="font"></code>)</li></ol><p>想要实现合成字体的效果，一个最简单的思路，本文也基于该思路：不让程序使用某个具体的字体，而是使用通用字体族名 (Generic Font Family)。比如，让程序使用 sans-serif，也就是默认的无衬线字体。</p><p>我们要关心第四个部分，即匹配阶段，使用 fontconfig 配置如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>sans-serif<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Twemoji<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这种 font stack 的方式，即可让程序按照以下顺序渲染字体：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Noto Sans CJK SC —&gt; Noto Sans -&gt; Twemoji
</span></span></code></pre></td></tr></table></div></div><p>这里的<code>&lt;test></code>就是条件判断，<code>mode="prepend"</code>指在前添加，<code>binding="strong"</code>则是强绑定</p><h2 id=开始配置><a href=#%e5%bc%80%e5%a7%8b%e9%85%8d%e7%bd%ae class=header-anchor></a>开始配置</h2><p>我们的思路就是就是修改默认的字族，让其成为我们想要指定的字体。然后将所有程序的字体配置改为通用字体族名：sans-serif，serif，monospace。</p><p>我们的配置都放在此目录中<code>~/.config/fontconfig/fonts.conf</code>，我的完整配置在<a class=link href=https://github.com/luoboQAQ/dotconfig/tree/main/fontconfig target=_blank rel=noopener>此仓库</a>中。</p><h3 id=设置默认字体><a href=#%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4%e5%ad%97%e4%bd%93 class=header-anchor></a>设置默认字体</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=c>&lt;!-- Default system-ui fonts --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>system-ui<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>sans-serif<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/match&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Default sans-serif fonts--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>sans-serif<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Noto Sans CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Noto Sans<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Twemoji<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/match&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Default serif fonts--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>serif<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Noto Serif CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Noto Serif<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Twemoji<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/match&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Default monospace fonts--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>monospace<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Noto Sans Mono CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Symbols Nerd Font<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Twemoji<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/match&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>compare=</span><span class=s>&#34;contains&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Source Code<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;string&gt;</span>Fira Code<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>对 system-ui，sans-serif，serif，monospace 设置优先显示的字体。在这里我让 system-ui 默认为无衬线。注意，system-ui 必须在最前。由于 fontconfig 对 font pattern 的操作是按顺序执行的，所以必须先让 system-ui 能优先以 sans-serif 显示，然后才是对 sans-serif 的操作。</p><p>所有的 Noto CJK 字体都以 SC 结尾，因为我希望在没指定语言的默认情况下，以简体中文显示中文字形。</p><h3 id=设置异形字><a href=#%e8%ae%be%e7%bd%ae%e5%bc%82%e5%bd%a2%e5%ad%97 class=header-anchor></a>设置异形字</h3><p>什么是异形字？Noto Sans CJK 中的异体字，是在 <strong>相同的</strong> Unicode 码位下，不同的语言会使用不同的字形。</p><p>可以在双猫大佬的<a class=link href=https://catcat.cc/raw/fontconfig.html#%E5%BC%82%E4%BD%93%E5%AD%97 target=_blank rel=noopener>这个测试网站</a>中看到，不同的语言环境下，这些字的显示是不同的。</p><p><img src=/p/linux-font/IMAGE/font_glyph_variants.png width=250 height=280 srcset="/p/linux-font/IMAGE/font_glyph_variants_hu_748a2ef604a61235.png 480w, /p/linux-font/IMAGE/font_glyph_variants_hu_92a7f637e7b2aeb8.png 1024w" loading=lazy alt=异形字 class=gallery-image data-flex-grow=89 data-flex-basis=214px></p><p>我们想要实现在保留异体字的情况下，让它默认显示中国大陆字形；只在特定语言下显示异体字，比如用浏览器查看一个日文页面。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- Replace fonts for Japanese --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;lang&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>ja<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK JP<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在字体匹配时，将 Noto Sans CJK SC 替换成 Noto Sans CJK JP。除了 ，你还需要照葫芦画瓢分别指定 zh-TW、zh-HK、ja、ko，以及对宋体和等宽字体进行重复的步骤。在此我就不重复了。</p><h3 id=解决全角引号><a href=#%e8%a7%a3%e5%86%b3%e5%85%a8%e8%a7%92%e5%bc%95%e5%8f%b7 class=header-anchor></a>解决全角引号</h3><p>英文中的单引号有两种，<code>'</code>(U+0027) 和<code>’</code>(U+2019)。可能会觉得前一种出现在英文文本中，后一种出现在中文文本中，并且宽度和中文等宽。然而，英语世界中的一些人在英文文章中也是会使用后一种的。所以，字体在显示后一种引号的时候，究竟是和英文字母一样窄，还是该和中文字体等宽呢？如果在英文文章中显示成全宽字符则会显得突兀。</p><p>比如，思源黑体其实也包含了拉丁字母的字形，可以完全使用思源黑体去显示西文。此时，后一种单引号的宽度会显示成中文字形的宽度。导致即使在全英文环境中，单引号也会突兀地在文本中过宽。</p><p>同样地，<code>‘</code>(U+2018) <code>“</code>(U+201C) <code>”</code>(U+201D) 也有类似的情况。</p><p>我们的目标是在不同语言环境下字形会有所区别，让引号只在中文文本中全宽。</p><p>同样，在双猫大佬的<a class=link href=https://catcat.cc/raw/fontconfig.html#%E5%BC%82%E4%BD%93%E5%AD%97 target=_blank rel=noopener>这个测试网站</a>中可以进行测试：</p><p><img src=/p/linux-font/IMAGE/font_quote.png width=280 height=85 srcset="/p/linux-font/IMAGE/font_quote_hu_c4b7d90fcc11c9b2.png 480w, /p/linux-font/IMAGE/font_quote_hu_4db44c4d82d44826.png 1024w" loading=lazy alt=全角引号 class=gallery-image data-flex-grow=329 data-flex-basis=790px></p><p>利用fontconfig，可以方便的解决此问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- 解决全角引号 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;lang&#34;</span> <span class=na>compare=</span><span class=s>&#34;contains&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>en<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>compare=</span><span class=s>&#34;contains&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=覆盖西文字体><a href=#%e8%a6%86%e7%9b%96%e8%a5%bf%e6%96%87%e5%ad%97%e4%bd%93 class=header-anchor></a>覆盖西文字体</h3><p>如果去观察 Noto Sans CJK 这个中文字体，会发现它的西文部分的字形其实和 Noto Sans 不一样，虽然它们都以 Noto 自称。中文字体携带的英文字符有可能十分糟糕，特别是 Windows 自带的 SimHei，也就是中易黑体，它的英文相当糟糕。另外，微软雅黑的字重实在是太少了，对于设计师来说很不友好。而各种流行的英文字体支持很多字重。</p><p>Noto Sans CJK 的英文还是比较不错的，为了字体的样式统一，这里就不修改sans-serif和seri了。主要将编程用的等宽字体换成Fira Code。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- Replace english fonts--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;prgname&#34;</span> <span class=na>compare=</span><span class=s>&#34;not_eq&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>msedge<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>compare=</span><span class=s>&#34;contains&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans Mono CJK<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Fira Code<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里为什么要多加一句判断呢？这是因为有些程序居然只使用 font pattern 结果中的首个字体，比如 Chrome（以及衍生的Chromium），虽然 Chrome 接受了我们指定的西文字体，但是它忽略了紧接其后的中文字体，即使配置采用了强绑定！然后中文字体又不知道它 fallback 到哪去了，可能会出现你想要的中文字体，也可能不是。</p><p>这里是 msedge 主要是我平时都用 edge 而不是 Chrome。可惜由于 Chromium 在 Linux 上小问题实在是太多了，还是老老实实的用 firefox 吧。</p><p>在所有情况下，除了程序名为 msedge 的情况下，优先使用 Fira Code 显示西文，再用 Noto Sans Mono CJK 显示中文。虽然我不能让 msedge 使用 Fira Code，但它一定能用上 Noto Sans Mono CJK 显示中文。</p><h3 id=替换任意字体><a href=#%e6%9b%bf%e6%8d%a2%e4%bb%bb%e6%84%8f%e5%ad%97%e4%bd%93 class=header-anchor></a>替换任意字体</h3><p>当系统里已经安装了一些不需要的字体，但又不想删除或者屏蔽它怎么办呢？替换掉 font pattern 就可以了。</p><p>我这里则是用来替换思源字体，毕竟它就是 Noto 嘛</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>qual=</span><span class=s>&#34;any&#34;</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Source Han Sans<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span> <span class=na>binding=</span><span class=s>&#34;same&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=字体渲染参数><a href=#%e5%ad%97%e4%bd%93%e6%b8%b2%e6%9f%93%e5%8f%82%e6%95%b0 class=header-anchor></a>字体渲染参数</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!--rendering options--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;font&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;autohint&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;bool&gt;</span>false<span class=nt>&lt;/bool&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;hinting&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;bool&gt;</span>true<span class=nt>&lt;/bool&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;hintstyle&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;const&gt;</span>hintslight<span class=nt>&lt;/const&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;antialias&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;bool&gt;</span>true<span class=nt>&lt;/bool&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;lcdfilter&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;const&gt;</span>lcddefault<span class=nt>&lt;/const&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;rgba&#34;</span> <span class=na>mode=</span><span class=s>&#34;assign&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;const&gt;</span>rgb<span class=nt>&lt;/const&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里主要设置了一些字体的渲染方式：</p><ul><li><code>autohint</code>：优先使用内嵌微调</li><li><code>hinting</code>：开启微调</li><li><code>hintstyle</code>：微调的程度，轻微</li><li><code>antialias</code>：开启抗锯齿功能</li><li><code>lcdfilter</code>：LCD filter 的风格，默认</li><li><code>rgba</code>：LCD 子像素的排列顺序，rgb</li></ul><p>这里就直接抄作业了。</p><h2 id=遇到的问题><a href=#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98 class=header-anchor></a>遇到的问题</h2><h3 id=全角引号设置无效><a href=#%e5%85%a8%e8%a7%92%e5%bc%95%e5%8f%b7%e8%ae%be%e7%bd%ae%e6%97%a0%e6%95%88 class=header-anchor></a>全角引号设置无效</h3><p>一开始我遇到了这个问题，无论怎么设置都是半角，经过排查以及网友的留言后发现，这是由于系统变量中的<code>LANG</code>为<code>en_US.utf-8</code>，这会导致传递给 fontconfig 的 lang 是 <code>lang: zh-cn(s) "en"(w)</code>。于是就一直匹配西文字体。</p><p>解决办法有两个，一个是直接修改<code>LANG</code>环境变量为<code>zh_CN.UTF-8</code>，我目前采用的就是这种形式。</p><p>或者就是默认渲染英文，当网页声明是中文时再换字体，相关配置如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- Default sans-serif fonts--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>sans-serif<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Color Emoji<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- cn --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;match</span> <span class=na>target=</span><span class=s>&#34;pattern&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;lang&#34;</span> <span class=na>compare=</span><span class=s>&#34;contains&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>cn<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;test</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>compare=</span><span class=s>&#34;contains&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/test&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;edit</span> <span class=na>name=</span><span class=s>&#34;family&#34;</span> <span class=na>mode=</span><span class=s>&#34;prepend&#34;</span> <span class=na>binding=</span><span class=s>&#34;strong&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;string&gt;</span>Noto Sans CJK SC<span class=nt>&lt;/string&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/edit&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/match&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这样如果网页声明了<code>lang=zh-cn</code>，就会用<code>Noto Sans CJK SC</code>字体进行覆盖，也就实现了全宽引号。假如网页没有声明<code>lang</code>或者错误地声明了<code>lang=en</code>，这时就会出现半角引号+汉字的组合了。</p><h2 id=不能解决的问题><a href=#%e4%b8%8d%e8%83%bd%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98 class=header-anchor></a>不能解决的问题</h2><p>Linux 不强迫程序必须使用特定的依赖，而是程序主动选择了约定俗成的依赖。老话重谈，程序可以自由选择完全遵守 fontconfig，也可以选择部分使用 fontconfig 的配置，或者完全不遵守它。这也导致了对一些程序无法实现字体的修改。以及上面提到的 chrome 对 fontconfig 并不是很好，或许面对这种程序，就需要合成字体的出场了。</p><h2 id=参考文献><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae class=header-anchor></a>参考文献</h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a class=link href=http://www.jinbuguo.com/gui/linux_fontconfig.html target=_blank rel=noopener>Linux字体美化实战(Fontconfig配置) [金步国]</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a class=link href=https://blog.lilydjwg.me/2023/3/5/linux-fonts.216591.html target=_blank rel=noopener>Linux 上的字体配置与故障排除 - 依云&rsquo;s Blog</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a class=link href=https://catcat.cc/post/2021-03-07/ target=_blank rel=noopener>用 fontconfig 治理 Linux 中的字体 - 双猫CC</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><footer class=article-footer><section class=article-tags><a href=/tags/linux/>Linux</a>
<a href=/tags/%E5%AD%97%E4%BD%93/>字体</a>
<a href=/tags/%E6%95%99%E7%A8%8B/>教程</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/redroid-maa/><div class=article-image><img src=/p/redroid-maa/103123878.425fb29b4c7eeec9c21caf05a0cda1a3.webp width=4500 height=2010 loading=lazy alt="Featured image of post ReDroid+MAA：在Linux下游玩明日方舟" data-key=redroid-maa data-hash="md5-Ql+ym0x+7snCHK8FoM2how=="></div><div class=article-details><h2 class=article-title>ReDroid+MAA：在Linux下游玩明日方舟</h2></div></a></article><article class=has-image><a href=/p/svp4inlinux/><div class=article-image><img src=/p/svp4inlinux/100213137.f404b00a110b1607fa43c905c6b9f68c.webp width=2200 height=1553 loading=lazy alt="Featured image of post 在Linux下安装SVP4" data-key=svp4inlinux data-hash="md5-9ASwChELFgf6Q8kFxrn2jA=="></div><div class=article-details><h2 class=article-title>在Linux下安装SVP4</h2></div></a></article></div></div></aside><link href=//unpkg.com/@waline/client@v3/dist/waline.css rel=stylesheet><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script type=module>
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';

    setTimeout(function () {
        
        init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.2.0/weibo"],"lang":"zh-CN","locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline.lbqaq.top/"});
    }, 300);


</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 luoboQAQ</section><section class=powerby><a href=https://umami.lbqaq.top/share/gbMqUqkF/Blog>访问统计</a><br><a href=https://beian.miit.gov.cn>苏ICP备2021037116号</a><br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://npm.elemecdn.com/node-vibrant@latest/dist/vibrant.min.js crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e);const t=document.createElement("link");t.href="https://cdn.jsdelivr.net/npm/@callmebill/lxgw-wenkai-web@latest/style.css",t.type="text/css",t.rel="stylesheet",document.head.appendChild(t)})()</script></body></html>